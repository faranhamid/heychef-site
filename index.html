<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HeyChef!">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366f1" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#4f46e5" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#1d4ed8">
    <meta name="description" content="HeyChef! - AI-powered personalized recipes for culinary innovation. Discover custom meals tailored to your cravings and dietary needs.">
    <meta property="og:title" content="HeyChef! - Culinary Innovation with AI">
    <meta property="og:description" content="Experience personalized, AI-generated recipes that fit your lifestyle. Subscribe today and elevate your cooking game.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1555939594-58d7cb2e254f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80">
    <meta property="og:url" content="https://yourdomain.com">
    <title>HeyChef! - AI-Powered Culinary Innovation</title>
    <link rel="icon" href="https://via.placeholder.com/32?text=HC" type="image/png">
    <link rel="stylesheet" href="style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>
    <header class="navbar">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="logo">
            <nav class="nav-links desktop-nav">
                <a href="#home">Home</a>
                <a href="#features">Features</a>
                <a href="#how-it-works">How It Works</a>
                <a href="#subscriptions">Subscriptions</a>
                <a href="#testimonials">Testimonials</a>
                <a href="#faq">FAQ</a>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLScVcxfhDDyvJRZISvcA7xZj1tDJxzvcEA2hZ7_6G7SoJ939OQ/viewform?usp=header" target="_blank">Affiliate</a>
            </nav>
            <div class="auth-controls" id="auth-controls">
                <button class="cta-button login-btn" onclick="signInWithGoogle()">Sign In with Google</button>
            </div>
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <nav class="mobile-nav" id="mobile-nav">
            <a href="#home">Home</a>
            <a href="#features">Features</a>
            <a href="#how-it-works">How It Works</a>
            <a href="#subscriptions">Subscriptions</a>
            <a href="#testimonials">Testimonials</a>
            <a href="#faq">FAQ</a>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLScVcxfhDDyvJRZISvcA7xZj1tDJxzvcEA2hZ7_6G7SoJ939OQ/viewform?usp=header" target="_blank">Affiliate</a>
        </nav>
    </header>

    <section id="home" class="hero-section">
        <div class="hero-background">
            <img src="https://images.unsplash.com/photo-1555939594-58d7cb2e254f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" alt="Delicious AI-generated meal" loading="lazy">
            <div class="hero-overlay"></div>
        </div>
        
        <!-- Floating decorative elements -->
        <div class="floating-elements">
            <div class="floating-icon" style="top: 15%; left: 10%; animation-delay: 0s;">
                <i class="fas fa-utensils"></i>
            </div>
            <div class="floating-icon" style="top: 25%; right: 15%; animation-delay: 1s;">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="floating-icon" style="top: 60%; left: 5%; animation-delay: 2s;">
                <i class="fas fa-fire"></i>
            </div>
            <div class="floating-icon" style="top: 70%; right: 10%; animation-delay: 3s;">
                <i class="fas fa-heart"></i>
            </div>
            <div class="floating-icon" style="top: 85%; left: 20%; animation-delay: 4s;">
                <i class="fas fa-star"></i>
            </div>
        </div>
        
        <div class="container">
            <div class="hero-content animate__animated animate__fadeIn">
                <h1>Revolutionize Your Kitchen with AI-Powered Recipes</h1>
                <div class="hero-cta-container">
                    <a href="#subscriptions" class="cta-button hero-cta">
                        <span>Start Your Culinary Journey</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="features-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">Why Choose HeyChef!?</h2>
            <p class="section-intro">Discover the features that make HeyChef! the ultimate tool for modern cooking. Our AI-driven platform combines technology with culinary expertise to bring you endless inspiration.</p>
            <div class="features-grid">
                <div class="feature-card">
                    <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Couple cooking together" loading="lazy">
                    <h3>Personalized Recipes</h3>
                    <p>Tailor-made meals based on your max calories, protein preferences, and more. Say goodbye to generic cookbooks and hello to recipes that suit you perfectly.</p>
                </div>
                <div class="feature-card">
                    <img src="https://images.unsplash.com/photo-1490645935967-10de6ba17061?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Nutritional insights" loading="lazy">
                    <h3>Detailed Nutrition</h3>
                    <p>Get comprehensive breakdowns of calories, proteins, fats, carbs, and more. Make informed choices for a healthier you.</p>
                </div>
                <div class="feature-card">
                    <img src="https://images.unsplash.com/photo-1543353071-873f17a7a088?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Easy instructions" loading="lazy">
                    <h3>Step-by-Step Instructions</h3>
                    <p>Clear, easy-to-follow guides with ingredients lists and preparation steps. Perfect for beginners and pros alike.</p>
                </div>
                <div class="feature-card">
                    <img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Community and affiliates" loading="lazy">
                    <h3>Affiliate Program</h3>
                    <p>Join our community and earn 20% commissions by sharing HeyChef! with your network.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="how-it-works" class="how-it-works-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">How HeyChef! Works</h2>
            <p class="section-intro">Getting started is simple. Follow these steps to unlock a world of personalized culinary delights.</p>
            <div class="steps-grid">
                <div class="step">
                    <img src="https://images.unsplash.com/photo-1517336714731-489689fd1ca8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Sign up" loading="lazy">
                    <h3>1. Sign Up & Subscribe</h3>
                    <p>Create an account and choose a plan to access our premium features.</p>
                </div>
                <div class="step">
                    <img src="https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Input preferences" loading="lazy">
                    <h3>2. Input Your Preferences</h3>
                    <p>Enter max calories and what you're craving – our AI does the rest.</p>
                </div>
                <div class="step">
                    <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Generate recipes" loading="lazy">
                    <h3>3. Generate & Enjoy</h3>
                    <p>Browse AI-generated recipes, complete with images, nutrition, and instructions.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="subscriptions" class="subscription-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">Choose Your Subscription Plan</h2>
            <p class="section-intro">Unlock unlimited access to personalized recipes with our flexible plans. Save more with annual billing.</p>
            <div class="pricing-grid">
                <div class="pricing-card">
                    <h3>Monthly Plan</h3>
                    <p class="price">$9.99 <span>/month</span></p>
                    <ul class="features">
                        <li>Unlimited recipe generations</li>
                        <li>Personalized AI recommendations</li>
                        <li>Detailed nutritional analysis</li>
                        <li>Access to community forums</li>
                        <li>Priority customer support</li>
                    </ul>
                    <button id="monthly-subscribe" class="cta-button">Subscribe Now</button>
                </div>
                <div class="pricing-card featured">
                    <span class="featured-badge">Best Value</span>
                    <h3>Annual Plan</h3>
                    <p class="price">$99.99 <span>/year</span> <span class="save">(Save 16%)</span></p>
                    <ul class="features">
                        <li>Unlimited recipe generations</li>
                        <li>Personalized AI recommendations</li>
                        <li>Detailed nutritional analysis</li>
                        <li>Access to community forums</li>
                        <li>Priority customer support</li>
                        <li>Exclusive recipe collections</li>
                        <li>Early access to new features</li>
                    </ul>
                    <button id="annual-subscribe" class="cta-button">Subscribe Now</button>
                </div>
            </div>
        </div>
    </section>

    <section id="testimonials" class="testimonials-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">What Our Users Say</h2>
            <p class="section-intro">Hear from real people who have transformed their cooking with HeyChef!.</p>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User avatar" loading="lazy">
                    <p>"HeyChef! has revolutionized my meal planning. The AI suggestions are spot on!"</p>
                    <h4>- Sarah J., Fitness Enthusiast</h4>
                </div>
                <div class="testimonial-card">
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User avatar" loading="lazy">
                    <p>"Incredible value! The recipes are delicious and easy to follow."</p>
                    <h4>- Mike T., Busy Professional</h4>
                </div>
                <div class="testimonial-card">
                    <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="User avatar" loading="lazy">
                    <p>"As a vegetarian, finding varied recipes was hard – until HeyChef!"</p>
                    <h4>- Emily R., Home Chef</h4>
                </div>
            </div>
        </div>
    </section>

    <section id="affiliate" class="affiliate-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">Become an Affiliate Partner</h2>
            <p class="section-description">Earn a generous 20% recurring commission for every referral that subscribes. Join a community of influencers and food lovers promoting innovative culinary tech. With easy tracking and marketing tools, maximize your earnings while sharing the joy of AI-powered cooking.</p>
            <button class="cta-button" onclick="window.location.href='https://docs.google.com/forms/d/e/1FAIpQLScVcxfhDDyvJRZISvcA7xZj1tDJxzvcEA2hZ7_6G7SoJ939OQ/viewform?usp=header';">Apply Today</button>
        </div>
    </section>

    <section id="faq" class="faq-section">
        <div class="container">
            <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <p class="section-intro">Got questions? We've got answers. Explore common queries about HeyChef!.</p>
            <div class="faq-accordion">
                <div class="faq-item">
                    <button class="faq-question">What makes HeyChef! different from other recipe apps?</button>
                    <div class="faq-answer">
                        <p>HeyChef! uses advanced AI to generate truly personalized recipes based on your specific inputs, unlike static databases in other apps.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">Can I cancel my subscription anytime?</button>
                    <div class="faq-answer">
                        <p>Yes, subscriptions can be canceled at any time through your account settings.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">Is HeyChef! suitable for dietary restrictions?</button>
                    <div class="faq-answer">
                        <p>Absolutely! Input your preferences, and our AI will tailor recipes accordingly, including vegan, gluten-free, and more.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <button class="faq-question">How secure is my data?</button>
                    <div class="faq-answer">
                        <p>We prioritize privacy with encrypted data and compliance with industry standards. See our Privacy Policy for details.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <main id="recipe-section" class="recipe-section" style="display: none;">
        <div class="generator-hero">
            <img src="https://images.unsplash.com/photo-1495195134817-aeb325a55b65?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80" alt="AI Recipe Generator Background" loading="lazy">
            <div class="generator-overlay"></div>
            <div class="generator-content">
                <h1>Unlock Endless Culinary Possibilities with AI</h1>
                <p>Our advanced AI generator creates custom recipes tailored to your tastes. Input your preferences below and watch the magic happen. From quick snacks to gourmet dinners, HeyChef! has you covered with innovative, healthy, and delicious ideas.</p>
            </div>
        </div>
        <div class="container">
            <section id="recipe-form-section" class="recipe-form-section">
                <img src="images/logo.png" alt="HeyChef! Logo" class="section-logo">
                <h2 class="section-title">Create Your Personalized Recipe</h2>
                <p class="section-intro">Enter your details below, and let our AI craft the perfect meal for you. Experiment with different cravings and calorie limits to discover new favorites.</p>
                <div class="form-container">
                    <label for="calories">Maximum Calories</label>
                    <input type="number" id="calories" placeholder="e.g., 500" required>
                    <label for="protein">What Are You Craving?</label>
                    <input type="text" id="protein" placeholder="e.g., chicken, tofu, pasta" required>
                    <button type="button" class="cta-button" onclick="generateRecipes()">Generate Recipes</button>
                </div>
                <div class="generator-tips">
                    <h3>Pro Tips for Best Results</h3>
                    <ul>
                        <li>Be specific with your cravings for more accurate suggestions.</li>
                        <li>Try combining ingredients like "vegan pasta" or "low-carb chicken."</li>
                        <li>Adjust calorie limits to match your dietary goals.</li>
                        <li>Browse multiple recipes using the navigation buttons.</li>
                    </ul>
                </div>
            </section>
            <section id="results" class="results-section">
                <div class="results-intro">
                    <h3>Your Generated Recipes</h3>
                    <p>Explore the AI-curated recipes below. Each one includes detailed nutrition, ingredients, and step-by-step instructions. Navigate through options to find your perfect match.</p>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-logo">
                    <img src="images/logo.png" alt="HeyChef! Logo" class="footer-logo-img">
                    <p>AI-Powered Culinary Innovation</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#subscriptions">Subscriptions</a></li>
                        <li><a href="#affiliate">Affiliate</a></li>
                    </ul>
                </div>
                <div class="footer-social">
                    <h4>Follow Us</h4>
                    <a href="https://x.com/Heychefmenu" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/heychefmenu/?hl=en" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: support@heychef.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2025 HeyChef! All Rights Reserved. <a href="#privacy" onclick="showPrivacyPolicy(event)">Privacy Policy</a> | <a href="#terms" onclick="showTermsOfService(event)">Terms of Service</a></p>
            </div>
        </div>
    </footer>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">×</span>
            <div id="modal-text"></div>
        </div>
    </div>

    <script type="module">
        // Firebase and Auth logic remains similar, with adjustments for new elements
        const firebaseConfig = {
            apiKey: "AIzaSyC1jGVeSifZHrfkLSNeiM7E27u5zBta8LA",
            authDomain: "heychef-20b0b.firebaseapp.com",
            projectId: "heychef-20b0b",
            storageBucket: "heychef-20b0b.firebasestorage.app",
            messagingSenderId: "807625257042",
            appId: "1:807625257042:web:9cee7a67d15c940239af8b",
            measurementId: "G-JN8NT9C3M7"
        };
        
        // Debug: Log current domain for Firebase troubleshooting
        console.log('Current domain:', window.location.hostname);
        console.log('Current URL:', window.location.href);

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithRedirect, signInWithPopup, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Debug: Check if Firebase is initialized
        console.log('Firebase initialized:', !!app);
        console.log('Auth initialized:', !!auth);
        console.log('Firestore initialized:', !!db);
        
        // Test Firebase connection on load
        window.addEventListener('load', () => {
            console.log('Testing Firebase connection...');
            const testDoc = doc(db, 'test', 'connection');
            getDoc(testDoc).then(() => {
                console.log('✅ Firebase connection successful');
            }).catch((error) => {
                console.log('❌ Firebase connection failed:', error.message);
            });
        });

        // Helper Functions
        function showWelcomeMessage(email) {
            const modalText = document.getElementById('modal-text');
            modalText.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">🎉 Welcome to HeyChef!</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Hi ${email.split('@')[0]}! You're all set to start creating amazing recipes.</p>
                    <p style="color: var(--text-light);">Your subscription is active and you now have unlimited access to our AI-powered recipe generator!</p>
                </div>
            `;
            document.getElementById('modal').style.display = 'flex';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                document.getElementById('modal').style.display = 'none';
            }, 3000);
        }

        function showSubscriptionRequired() {
            const modalText = document.getElementById('modal-text');
            modalText.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">🔒 Subscription Required</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">To access our AI-powered recipe generator, you need an active subscription.</p>
                    <p style="color: var(--text-light); margin-bottom: 2rem;">Choose a plan below to unlock unlimited recipe generation!</p>
                    <button class="cta-button" onclick="closeModal()" style="margin: 0 auto;">Get Started</button>
                </div>
            `;
            document.getElementById('modal').style.display = 'flex';
        }

        // Modal Functions (unchanged)
        window.showPrivacyPolicy = function(event) {
            event.preventDefault();
            document.getElementById('modal-text').innerHTML = `
                <h2>Privacy Policy</h2>
                <p>At HeyChef!, we prioritize your privacy, collecting data only to enhance your experience. Your information is encrypted and used solely for service improvement, never shared without consent unless legally required. Contact support@heychef.com for data inquiries.</p>
            `;
            document.getElementById('modal').style.display = 'flex';
        };

        window.showTermsOfService = function(event) {
            event.preventDefault();
            document.getElementById('modal-text').innerHTML = `
                <h2>Terms of Service</h2>
                <p>By using HeyChef!, you agree to these terms. Services are provided 'as is,' with no liability for indirect damages. Users must be 13+; subscriptions follow our pricing policy. We may update terms with notice.</p>
            `;
            document.getElementById('modal').style.display = 'flex';
        };

        window.closeModal = function() {
            document.getElementById('modal').style.display = 'none';
        };

        // User Dropdown Functions
        window.toggleUserDropdown = function() {
            const dropdown = document.getElementById('user-dropdown-menu');
            dropdown.classList.toggle('active');
        };

        window.showAccountInfo = function() {
            const user = auth.currentUser;
            const modalText = document.getElementById('modal-text');
            modalText.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">👤 Account Information</h2>
                    <div style="text-align: left; max-width: 400px; margin: 0 auto;">
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>User ID:</strong> ${user.uid}</p>
                        <p><strong>Account Created:</strong> ${user.metadata.creationTime ? new Date(user.metadata.creationTime).toLocaleDateString() : 'N/A'}</p>
                        <p><strong>Last Sign In:</strong> ${user.metadata.lastSignInTime ? new Date(user.metadata.lastSignInTime).toLocaleDateString() : 'N/A'}</p>
                    </div>
                </div>
            `;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('user-dropdown-menu').classList.remove('active');
        };

        window.showSubscriptionDetails = function() {
            const modalText = document.getElementById('modal-text');
            modalText.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h2 style="color: var(--primary); margin-bottom: 1rem;">💳 Subscription Details</h2>
                    <div style="text-align: left; max-width: 400px; margin: 0 auto;">
                        <p><strong>Status:</strong> <span style="color: var(--accent);">Active</span></p>
                        <p><strong>Plan:</strong> Premium Access</p>
                        <p><strong>Features:</strong></p>
                        <ul style="margin-left: 1rem;">
                            <li>Unlimited recipe generations</li>
                            <li>Personalized AI recommendations</li>
                            <li>Detailed nutritional analysis</li>
                            <li>Priority customer support</li>
                        </ul>
                    </div>
                </div>
            `;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('user-dropdown-menu').classList.remove('active');
        };

        window.showUnsubscribeModal = function() {
            const modalText = document.getElementById('modal-text');
            modalText.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <h2 style="color: #ef4444; margin-bottom: 1rem;">⚠️ Unsubscribe from HeyChef!</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Are you sure you want to cancel your subscription?</p>
                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                        <p style="color: #dc2626; margin: 0;"><strong>What happens when you unsubscribe:</strong></p>
                        <ul style="text-align: left; margin: 1rem 0 0 0; padding-left: 1.5rem;">
                            <li>You'll lose access to the AI recipe generator</li>
                            <li>Your account will remain active but limited</li>
                            <li>You can resubscribe anytime</li>
                        </ul>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="cta-button" onclick="closeModal()" style="background: #6b7280;">Cancel</button>
                        <button class="cta-button" onclick="confirmUnsubscribe()" style="background: #ef4444;">Yes, Unsubscribe</button>
                    </div>
                </div>
            `;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('user-dropdown-menu').classList.remove('active');
        };

        window.localUnsubscribe = async function() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('No user logged in');
                    return;
                }

                // Update user subscription status in Firestore only
                const userDocRef = doc(db, 'users', user.uid);
                await setDoc(userDocRef, {
                    subscribed: false,
                    unsubscribedDate: new Date(),
                    subscriptionType: 'cancelled',
                    localCancellation: true
                }, { merge: true });

                // Show success message
                const modalText = document.getElementById('modal-text');
                modalText.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2 style="color: var(--accent); margin-bottom: 1rem;">✅ Locally Unsubscribed</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Your local subscription has been cancelled.</p>
                        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                            <p style="color: #92400e; margin: 0;"><strong>Important:</strong></p>
                            <p style="color: #92400e; margin: 0.5rem 0 0 0;">Please email support@heychef.com to cancel your Stripe billing subscription.</p>
                        </div>
                        <button class="cta-button" onclick="closeModal()">Close</button>
                    </div>
                `;

                // Redirect to subscription page after a delay
                setTimeout(() => {
                    closeModal();
                    // Force page reload to update UI
                    window.location.reload();
                }, 3000);

            } catch (error) {
                console.error('Error with local unsubscribe:', error);
                alert('Error updating local subscription. Please try again.');
            }
        };

        window.confirmUnsubscribe = async function() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('No user logged in');
                    return;
                }

                // Show loading state
                const modalText = document.getElementById('modal-text');
                modalText.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                        <h3>Cancelling Subscription...</h3>
                        <p>Please wait while we process your request.</p>
                    </div>
                `;

                // Call backend API to cancel Stripe subscription
                try {
                    const response = await fetch('/api/unsubscribe', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userId: user.uid,
                            email: user.email
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        let errorMessage;
                        try {
                            const errorData = JSON.parse(errorText);
                            errorMessage = errorData.error || 'Failed to cancel subscription';
                        } catch (parseError) {
                            errorMessage = `Server error: ${response.status} ${response.statusText}`;
                        }
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();
                } catch (apiError) {
                    console.log('Backend API unavailable, using local cancellation:', apiError);
                    
                    // Fallback: Show manual cancellation instructions
                    modalText.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <h2 style="color: var(--primary); margin-bottom: 1rem;">📧 Manual Cancellation Required</h2>
                            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Our automated system is temporarily unavailable.</p>
                            <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                                <p style="color: #0369a1; margin: 0;"><strong>To cancel your subscription:</strong></p>
                                <ol style="text-align: left; margin: 1rem 0 0 0; padding-left: 1.5rem;">
                                    <li>Email us at <strong>support@heychef.com</strong></li>
                                    <li>We'll cancel your subscription within 24 hours</li>
                                </ol>
                            </div>
                            <p style="color: var(--text-light); margin-bottom: 2rem;">We apologize for the inconvenience.</p>
                            <div style="display: flex; gap: 1rem; justify-content: center;">
                                <button class="cta-button" onclick="closeModal()" style="background: #6b7280;">Close</button>
                                <button class="cta-button" onclick="localUnsubscribe()" style="background: #ef4444;">Cancel Locally</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Update user subscription status in Firestore
                const userDocRef = doc(db, 'users', user.uid);
                await setDoc(userDocRef, {
                    subscribed: false,
                    unsubscribedDate: new Date(),
                    subscriptionType: 'cancelled',
                    stripeCancelledAt: result.cancelledAt
                }, { merge: true });

                // Show success message
                modalText.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2 style="color: var(--accent); margin-bottom: 1rem;">✅ Unsubscribed Successfully</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Your subscription has been cancelled.</p>
                        <p style="color: var(--text-light); margin-bottom: 2rem;">You can resubscribe anytime by visiting our subscription page.</p>
                        <button class="cta-button" onclick="closeModal()">Close</button>
                    </div>
                `;

                // Redirect to subscription page after a delay
                setTimeout(() => {
                    closeModal();
                    // Force page reload to update UI
                    window.location.reload();
                }, 3000);

            } catch (error) {
                console.error('Error unsubscribing:', error);
                
                // Show error message
                const modalText = document.getElementById('modal-text');
                modalText.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2 style="color: #ef4444; margin-bottom: 1rem;">❌ Error Cancelling Subscription</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">${error.message}</p>
                        <p style="color: var(--text-light); margin-bottom: 2rem;">Please try again or contact support if the problem persists.</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="cta-button" onclick="closeModal()" style="background: #6b7280;">Close</button>
                            <button class="cta-button" onclick="showUnsubscribeModal()" style="background: #ef4444;">Try Again</button>
                        </div>
                    </div>
                `;
            }
        };

        // Authentication Logic
        async function isSubscribed(user) {
            if (!user) return false;
            
            try {
                // Check if we're online
                if (!navigator.onLine) {
                    console.log('User is offline, skipping subscription check');
                    return false;
                }
                
                // First check local Firestore
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                let localSubscribed = false;
                
                if (userDoc.exists()) {
                    localSubscribed = userDoc.data().subscribed || false;
                } else {
                    // Create user document if it doesn't exist
                    await setDoc(userDocRef, {
                        email: user.email,
                        subscribed: false
                    });
                }
                
                // Then check with Stripe backend for real-time status
                try {
                    const response = await fetch('/api/subscription-status', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: user.email
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        
                        // Update local database if there's a discrepancy
                        if (result.subscribed !== localSubscribed) {
                            await setDoc(userDocRef, {
                                subscribed: result.subscribed,
                                lastChecked: new Date(),
                                stripeStatus: result.status,
                                cancelAtPeriodEnd: result.cancelAtPeriodEnd
                            }, { merge: true });
                        }
                        
                        return result.subscribed;
                    }
                } catch (apiError) {
                    console.log('Backend API unavailable, using local status:', apiError);
                    // Fall back to local status if backend is unavailable
                }
                
                return localSubscribed;
                
            } catch (error) {
                console.error('Error checking subscription status:', error);
                if (error.code === 'failed-precondition' || error.message.includes('offline')) {
                    console.log('Firebase is offline, allowing access for testing');
                    return true; // Allow access when offline for testing
                }
                return false;
            }
        }

        onAuthStateChanged(auth, async (user) => {
            try {
                console.log('Auth state changed:', user ? user.email : 'No user');
                
                const authControls = document.getElementById('auth-controls');
                const recipeSection = document.getElementById('recipe-section');
                const homeSection = document.getElementById('home');
                const featuresSection = document.getElementById('features');
                const howItWorksSection = document.getElementById('how-it-works');
                const subscriptionSection = document.getElementById('subscriptions');
                const testimonialsSection = document.getElementById('testimonials');
                const affiliateSection = document.getElementById('affiliate');
                const faqSection = document.getElementById('faq');

                if (user) {
                    try {
                        const subscribed = await isSubscribed(user);
                        console.log('User subscription status:', subscribed);

                        if (subscribed) {
                            // User is subscribed - show recipe generator
                            authControls.innerHTML = `
                                <div class="user-dropdown">
                                    <span class="user-email" onclick="toggleUserDropdown()">${user.email} <i class="fas fa-chevron-down"></i></span>
                                    <div class="dropdown-menu" id="user-dropdown-menu">
                                        <div class="dropdown-item" onclick="showAccountInfo()">
                                            <i class="fas fa-user"></i>
                                            <span>Account Info</span>
                                        </div>
                                        <div class="dropdown-item" onclick="showSubscriptionDetails()">
                                            <i class="fas fa-credit-card"></i>
                                            <span>Subscription</span>
                                        </div>
                                        <div class="dropdown-item" onclick="showUnsubscribeModal()">
                                            <i class="fas fa-times-circle"></i>
                                            <span>Unsubscribe</span>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <div class="dropdown-item" onclick="signOutUser()">
                                            <i class="fas fa-sign-out-alt"></i>
                                            <span>Sign Out</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                            showRecipeGenerator();
                            
                            // Show welcome message for subscribed users
                            showWelcomeMessage(user.email);
                        } else {
                            // User is logged in but not subscribed - show subscription page
                            authControls.innerHTML = `
                                <div class="user-dropdown">
                                    <span class="user-email" onclick="toggleUserDropdown()">${user.email} <i class="fas fa-chevron-down"></i></span>
                                    <div class="dropdown-menu" id="user-dropdown-menu">
                                        <div class="dropdown-item" onclick="showAccountInfo()">
                                            <i class="fas fa-user"></i>
                                            <span>Account Info</span>
                                        </div>
                                        <div class="dropdown-item" onclick="showSubscriptionDetails()">
                                            <i class="fas fa-credit-card"></i>
                                            <span>Subscription</span>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <div class="dropdown-item" onclick="signOutUser()">
                                            <i class="fas fa-sign-out-alt"></i>
                                            <span>Sign Out</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                            recipeSection.style.display = 'none';
                            homeSection.style.display = 'none';
                            featuresSection.style.display = 'none';
                            howItWorksSection.style.display = 'none';
                            subscriptionSection.style.display = 'block';
                            testimonialsSection.style.display = 'none';
                            affiliateSection.style.display = 'none';
                            faqSection.style.display = 'none';
                            
                            // Show subscription required message
                            showSubscriptionRequired();
                        }
                    } catch (subscriptionError) {
                        console.error('Subscription check failed:', subscriptionError);
                        // If subscription check fails, assume not subscribed for security
                        authControls.innerHTML = `
                            <span class="user-email">${user.email}</span>
                            <button class="cta-button logout-btn" onclick="signOutUser()">Sign Out</button>
                        `;
                        recipeSection.style.display = 'none';
                        homeSection.style.display = 'none';
                        featuresSection.style.display = 'none';
                        howItWorksSection.style.display = 'none';
                        subscriptionSection.style.display = 'block';
                        testimonialsSection.style.display = 'none';
                        affiliateSection.style.display = 'none';
                        faqSection.style.display = 'none';
                        
                        showSubscriptionRequired();
                    }
                } else {
                    // No user logged in - show landing page
                    authControls.innerHTML = `<button class="cta-button login-btn" onclick="signInWithGoogle()">Sign In with Google</button>`;
                    recipeSection.style.display = 'none';
                    homeSection.style.display = 'block';
                    featuresSection.style.display = 'block';
                    howItWorksSection.style.display = 'block';
                    subscriptionSection.style.display = 'block';
                    testimonialsSection.style.display = 'block';
                    affiliateSection.style.display = 'block';
                    faqSection.style.display = 'block';
                }
            } catch (error) {
                console.error('Error in auth state change:', error);
                if (navigator.onLine && !error.message.includes('offline')) {
                    alert('Authentication error: ' + error.message);
                }
            }
        });

        window.signInWithGoogle = async function() {
            try {
                console.log('Starting Google sign-in...');
                console.log('Current domain:', window.location.hostname);
                
                const provider = new GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                // Show loading state
                const loginBtn = document.querySelector('.login-btn');
                if (loginBtn) {
                    loginBtn.textContent = 'Signing in...';
                    loginBtn.disabled = true;
                }
                
                // Try popup first, fallback to redirect
                try {
                    console.log('Attempting popup sign-in...');
                    const result = await signInWithPopup(auth, provider);
                    console.log('Sign-in successful via popup:', result.user.email);
                } catch (popupError) {
                    console.log('Popup failed, trying redirect:', popupError);
                    console.log('Popup error code:', popupError.code);
                    
                    if (popupError.code === 'auth/unauthorized-domain') {
                        alert('Domain not authorized in Firebase. Please add ' + window.location.hostname + ' to Firebase console.');
                        return;
                    }
                    
                    await signInWithRedirect(auth, provider);
                }
            } catch (error) {
                console.error('Sign-in error:', error);
                console.error('Error code:', error.code);
                
                // Reset button state
                const loginBtn = document.querySelector('.login-btn');
                if (loginBtn) {
                    loginBtn.textContent = 'Sign In with Google';
                    loginBtn.disabled = false;
                }
                
                // Show specific error messages
                if (error.code === 'auth/popup-closed-by-user') {
                    console.log('User closed popup');
                } else if (error.code === 'auth/popup-blocked') {
                    alert('Popup blocked by browser. Please allow popups for this site.');
                } else if (error.code === 'auth/unauthorized-domain') {
                    alert('Domain not authorized in Firebase. Please add ' + window.location.hostname + ' to Firebase console.');
                } else if (error.code === 'auth/network-request-failed') {
                    alert('Network error. Please check your internet connection.');
                } else {
                    alert('Sign-in failed: ' + error.message + ' (Code: ' + error.code + ')');
                }
            }
        };

        window.signOutUser = async function() {
            try {
                console.log('Signing out user...');
                await signOut(auth);
                console.log('User signed out successfully');
            } catch (error) {
                console.error('Sign-out error:', error);
                alert('Sign-out error: ' + error.message);
            }
        };

        // Handle redirect result
        getRedirectResult(auth)
            .then((result) => {
                if (result) {
                    console.log('User signed in successfully:', result.user.email);
                    // User signed in
                    const user = result.user;
                    
                    // Check if user is returning from payment (check URL parameters)
                    const urlParams = new URLSearchParams(window.location.search);
                    const paymentSuccess = urlParams.get('payment_success');
                    const sessionId = urlParams.get('session_id');
                    
                    if (paymentSuccess === 'true' && sessionId) {
                        // User completed payment - update subscription status
                        updateSubscriptionStatus(user.uid, sessionId);
                    }
                }
            }).catch((error) => {
                console.error('Redirect sign-in error:', error);
                if (error.code !== 'auth/popup-closed-by-user') {
                    alert('Sign-in error: ' + error.message);
                }
            });

        // Function to update subscription status after payment
        async function updateSubscriptionStatus(userId, sessionId) {
            try {
                const userDocRef = doc(db, 'users', userId);
                await setDoc(userDocRef, {
                    subscribed: true,
                    subscriptionDate: new Date(),
                    sessionId: sessionId,
                    subscriptionType: 'active'
                }, { merge: true });
                
                console.log('Subscription status updated successfully');
                
                // Show success message and redirect to recipe generator
                const modalText = document.getElementById('modal-text');
                modalText.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h2 style="color: var(--accent); margin-bottom: 1rem;">🎉 Payment Successful!</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Your subscription is now active!</p>
                        <p style="color: var(--text-light); margin-bottom: 2rem;">Redirecting you to the recipe generator...</p>
                        <div style="display: flex; justify-content: center;">
                            <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                    </div>
                `;
                document.getElementById('modal').style.display = 'flex';
                
                // Redirect to recipe generator after 3 seconds
                setTimeout(() => {
                    showRecipeGenerator();
                }, 3000);
                
            } catch (error) {
                console.error('Error updating subscription status:', error);
                alert('Payment successful, but there was an issue updating your account. Please contact support.');
            }
        }

        // Function to show recipe generator
        function showRecipeGenerator() {
            const recipeSection = document.getElementById('recipe-section');
            const homeSection = document.getElementById('home');
            const featuresSection = document.getElementById('features');
            const howItWorksSection = document.getElementById('how-it-works');
            const subscriptionSection = document.getElementById('subscriptions');
            const testimonialsSection = document.getElementById('testimonials');
            const affiliateSection = document.getElementById('affiliate');
            const faqSection = document.getElementById('faq');

            // Hide all sections except recipe generator
            recipeSection.style.display = 'block';
            homeSection.style.display = 'none';
            featuresSection.style.display = 'none';
            howItWorksSection.style.display = 'none';
            subscriptionSection.style.display = 'none';
            testimonialsSection.style.display = 'none';
            affiliateSection.style.display = 'none';
            faqSection.style.display = 'none';

            // Close modal
            document.getElementById('modal').style.display = 'none';

            // Scroll to recipe generator
            recipeSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Recipe Generation (enhanced with better display)
        let recipes = [];
        let currentIndex = 0;

        window.generateRecipes = async function() {
            const calories = document.getElementById('calories').value;
            const protein = document.getElementById('protein').value.trim();

            if (!calories || !protein) {
                alert('Please fill in all fields!');
                return;
            }

            // Show loading state
            const generateBtn = document.querySelector('#recipe-form-section .cta-button');
            if (generateBtn) {
                generateBtn.textContent = 'Generating Recipes...';
                generateBtn.disabled = true;
            }

            // Show loading in results section
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <div style="width: 60px; height: 60px; border: 6px solid #f3f3f3; border-top: 6px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 2rem;"></div>
                    <h3>Generating Your Recipes...</h3>
                    <p>Our AI is crafting personalized recipes just for you!</p>
                </div>
            `;

            try {
                // Use a more reliable API key or fallback to demo data
                const apiKey = '0bf784244ef74e47bb54de046d7da861';
                const url = `https://api.spoonacular.com/recipes/complexSearch?apiKey=${apiKey}&maxCalories=${calories}&number=25&addRecipeInformation=true&addRecipeNutrition=true&instructionsRequired=true&fillIngredients=true&query=${protein}`;
                
                console.log('Fetching recipes from:', url);
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                recipes = data.results || [];
                currentIndex = 0;
                
                if (recipes.length === 0) {
                    resultsDiv.innerHTML = `
                        <div style="text-align: center; padding: 3rem;">
                            <h3>No recipes found</h3>
                            <p>Try different ingredients or calorie limits!</p>
                            <p style="color: var(--text-light); font-size: 0.9rem;">API Response: ${JSON.stringify(data)}</p>
                        </div>
                    `;
                    return;
                }
                
                console.log(`Found ${recipes.length} recipes`);
                displayRecipe();
                
            } catch (error) {
                console.error('Recipe generation error:', error);
                
                // Fallback to demo recipes if API fails
                recipes = generateDemoRecipes(calories, protein);
                currentIndex = 0;
                
                if (recipes.length > 0) {
                    resultsDiv.innerHTML = `
                        <div style="text-align: center; padding: 2rem; background: #fef3c7; border-radius: 12px; margin-bottom: 2rem;">
                            <h3>Demo Mode</h3>
                            <p>API temporarily unavailable. Showing demo recipes for your search.</p>
                        </div>
                    `;
                    displayRecipe();
                } else {
                    resultsDiv.innerHTML = `
                        <div style="text-align: center; padding: 3rem;">
                            <h3>Error Generating Recipes</h3>
                            <p>Please try again in a moment.</p>
                            <p style="color: var(--text-light); font-size: 0.9rem;">Error: ${error.message}</p>
                        </div>
                    `;
                }
            } finally {
                // Reset button state
                if (generateBtn) {
                    generateBtn.textContent = 'Generate Recipes';
                    generateBtn.disabled = false;
                }
            }
        };

        // Generate demo recipes as fallback
        function generateDemoRecipes(calories, protein) {
            const demoRecipes = [
                {
                    title: `Delicious ${protein} Recipe`,
                    image: 'https://images.unsplash.com/photo-1543353071-873f17a7a088?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                    nutrition: {
                        nutrients: [
                            { name: 'Calories', amount: parseInt(calories) * 0.8 },
                            { name: 'Protein', amount: 25 },
                            { name: 'Fat', amount: 12 },
                            { name: 'Carbohydrates', amount: 30 },
                            { name: 'Sugar', amount: 8 },
                            { name: 'Fiber', amount: 5 }
                        ]
                    },
                    extendedIngredients: [
                        { original: `1 lb ${protein}` },
                        { original: '2 tbsp olive oil' },
                        { original: '1 onion, diced' },
                        { original: '3 cloves garlic, minced' },
                        { original: 'Salt and pepper to taste' }
                    ],
                    analyzedInstructions: [{
                        steps: [
                            { step: `Season the ${protein} with salt and pepper.` },
                            { step: 'Heat olive oil in a large pan over medium heat.' },
                            { step: 'Add diced onion and cook until translucent.' },
                            { step: `Add ${protein} and cook until golden brown.` },
                            { step: 'Add garlic and cook for 1 minute.' },
                            { step: 'Serve hot and enjoy!' }
                        ]
                    }]
                },
                {
                    title: `Healthy ${protein} Bowl`,
                    image: 'https://images.unsplash.com/photo-1490645935967-10de6ba17061?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                    nutrition: {
                        nutrients: [
                            { name: 'Calories', amount: parseInt(calories) * 0.9 },
                            { name: 'Protein', amount: 30 },
                            { name: 'Fat', amount: 8 },
                            { name: 'Carbohydrates', amount: 25 },
                            { name: 'Sugar', amount: 5 },
                            { name: 'Fiber', amount: 8 }
                        ]
                    },
                    extendedIngredients: [
                        { original: `1 cup cooked ${protein}` },
                        { original: '2 cups mixed greens' },
                        { original: '1/2 cup quinoa' },
                        { original: '1/4 cup cherry tomatoes' },
                        { original: '2 tbsp balsamic vinaigrette' }
                    ],
                    analyzedInstructions: [{
                        steps: [
                            { step: 'Cook quinoa according to package instructions.' },
                            { step: `Prepare ${protein} by grilling or baking.` },
                            { step: 'Arrange mixed greens in a bowl.' },
                            { step: 'Top with quinoa and protein.' },
                            { step: 'Add cherry tomatoes and drizzle with vinaigrette.' },
                            { step: 'Toss gently and serve immediately.' }
                        ]
                    }]
                }
            ];
            
            return demoRecipes;
        }

        function displayRecipe() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            if (!recipes || recipes.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <h3>No recipes available</h3>
                        <p>Please try generating recipes again.</p>
                    </div>
                `;
                return;
            }
            
            const recipe = recipes[currentIndex];
            console.log('Displaying recipe:', recipe);
            
            if (!recipe) {
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <h3>Recipe not found</h3>
                        <p>Please try again.</p>
                    </div>
                `;
                return;
            }
            
            const { title, image, nutrition, extendedIngredients, analyzedInstructions } = recipe;
            const nutrients = nutrition.nutrients.reduce((acc, nut) => ({ ...acc, [nut.name]: nut.amount.toFixed(0) || 'N/A' }), {});

            const recipeDiv = document.createElement('div');
            recipeDiv.className = 'recipe-card animate__animated animate__fadeIn';
            recipeDiv.innerHTML = `
                <img src="${image}" alt="${title}" class="recipe-image" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1543353071-873f17a7a088?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'">
                <div class="recipe-content">
                    <h2 class="recipe-title">${title}</h2>
                    <div class="nutrition-grid">
                        <div class="nutrient-card"><span class="value">${nutrients.Calories || 'N/A'}</span><span>Calories</span></div>
                        <div class="nutrient-card"><span class="value">${nutrients.Protein || 'N/A'}g</span><span>Protein</span></div>
                        <div class="nutrient-card"><span class="value">${nutrients.Fat || 'N/A'}g</span><span>Fat</span></div>
                        <div class="nutrient-card"><span class="value">${nutrients.Carbohydrates || 'N/A'}g</span><span>Carbs</span></div>
                        <div class="nutrient-card"><span class="value">${nutrients.Sugar || 'N/A'}g</span><span>Sugar</span></div>
                        <div class="nutrient-card"><span class="value">${nutrients.Fiber || 'N/A'}g</span><span>Fiber</span></div>
                    </div>
                    <div class="ingredients-section">
                        <h3>Ingredients</h3>
                        <ul class="ingredient-list">${extendedIngredients.map(ing => `<li>${ing.original}</li>`).join('')}</ul>
                    </div>
                    <div class="instructions-section">
                        <h3>Instructions</h3>
                        <ol class="instruction-list">${analyzedInstructions.flatMap(section => section.steps.map(step => `<li>${step.step}</li>`)).join('')}</ol>
                    </div>
                    <div class="navigation">
                        <button onclick="prevRecipe()" ${currentIndex === 0 ? 'disabled' : ''} class="cta-button">Previous Recipe</button>
                        <button onclick="nextRecipe()" ${currentIndex === recipes.length - 1 ? 'disabled' : ''} class="cta-button">Next Recipe</button>
                    </div>
                </div>
            `;
            resultsDiv.appendChild(recipeDiv);
            
            // Scroll to the recipe
            recipeDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        window.prevRecipe = function() {
            if (currentIndex > 0) {
                currentIndex--;
                displayRecipe();
            }
        };

        window.nextRecipe = function() {
            if (currentIndex < recipes.length - 1) {
                currentIndex++;
                displayRecipe();
            }
        };

        // Additional JS for interactivity
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile menu toggle
            const toggle = document.getElementById('mobile-menu-toggle');
            const menu = document.getElementById('mobile-nav');
            toggle.addEventListener('click', () => {
                menu.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (event) => {
                const dropdown = document.getElementById('user-dropdown-menu');
                const userEmail = document.querySelector('.user-email');
                
                if (dropdown && dropdown.classList.contains('active')) {
                    if (!userEmail || !userEmail.contains(event.target)) {
                        dropdown.classList.remove('active');
                    }
                }
            });

            // FAQ accordion
            const faqQuestions = document.querySelectorAll('.faq-question');
            faqQuestions.forEach(question => {
                question.addEventListener('click', () => {
                    const answer = question.nextElementSibling;
                    answer.classList.toggle('active');
                    question.classList.toggle('active');
                });
            });

            // Smooth scroll
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            // Subscription buttons
            const monthlyButton = document.getElementById('monthly-subscribe');
            if (monthlyButton) {
                monthlyButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    let user = auth.currentUser;
                    if (!user) {
                        // User not logged in - sign them in first
                        await signInWithGoogle();
                        user = auth.currentUser;
                        // Wait a moment for auth to complete
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    if (user) {
                        // Check if user is already subscribed
                        try {
                            const subscribed = await isSubscribed(user);
                            if (subscribed) {
                                // User is already subscribed - redirect to recipe generator
                                showRecipeGenerator();
                                return;
                            }
                        } catch (error) {
                            console.error('Error checking subscription:', error);
                        }
                        
                        // User is not subscribed - redirect to Stripe checkout for monthly plan
                        const stripeUrl = 'https://buy.stripe.com/aFa3cw9GAczd2Sb6FTdQQ00?prefilled_email=' + encodeURIComponent(user.email) + '&client_reference_id=' + user.uid;
                        console.log('Redirecting to Stripe:', stripeUrl);
                        window.location.href = stripeUrl;
                    }
                });
            }

            const annualButton = document.getElementById('annual-subscribe');
            if (annualButton) {
                annualButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    let user = auth.currentUser;
                    if (!user) {
                        // User not logged in - sign them in first
                        await signInWithGoogle();
                        user = auth.currentUser;
                        // Wait a moment for auth to complete
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    if (user) {
                        // Check if user is already subscribed
                        try {
                            const subscribed = await isSubscribed(user);
                            if (subscribed) {
                                // User is already subscribed - redirect to recipe generator
                                showRecipeGenerator();
                                return;
                            }
                        } catch (error) {
                            console.error('Error checking subscription:', error);
                        }
                        
                        // User is not subscribed - redirect to Stripe checkout for annual plan
                        const stripeUrl = 'https://buy.stripe.com/fZu8wQg4Y9n1dwP7JXdQQ01?prefilled_email=' + encodeURIComponent(user.email) + '&client_reference_id=' + user.uid;
                        console.log('Redirecting to Stripe:', stripeUrl);
                        window.location.href = stripeUrl;
                    }
                });
            }
        });
    </script>
</body>
</html>